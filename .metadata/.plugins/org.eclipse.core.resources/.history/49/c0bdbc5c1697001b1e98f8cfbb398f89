package bsu.rfe.java.group7.lab7.Ryndin.var1;

import java.awt.Color;
import java.io.DataInputStream;
import java.io.IOException;
import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.net.Socket;

import javax.swing.JOptionPane;


public class ServerUser implements Runnable 
{
	///
	private int This_Server_Port;
	private int User_Port;
	private String InitServer_IpAdress;
	
	///авторизованные пользователи
	private int HowMany;
	private String[] IpAdress;
	private String[] NameUsers;
	private String[] SurnameUsers;
	

	//  онструктор класса BouncingBall
	public ServerUser(int Port_A,int Port_B,String IPServer) 
	{
		This_Server_Port = Port_A;
		User_Port = Port_B;
		InitServer_IpAdress = IPServer;
		HowMany = 0;///изначально никого нет
		
		
		Thread thisThread = new Thread(this);
		// «апускаем поток
		thisThread.start();
	}
	// ћетод run() исполн€етс€ внутри потока.  огда он завершает работу, 
	// то завершаетс€ и поток
	public void run() 
	{
		try 
		{
			//  рутим бесконечный цикл, т.е. пока нас не прервут, 
			// мы не намерены завершатьс€
			while(true) 
			{
				final ServerSocket AuthorisationSocket = new ServerSocket(This_Server_Port);
				try 
				{
					
					while (!Thread.interrupted()) 
					{
						
						Socket UserSocket = AuthorisationSocket.accept();
						int i = 0;
						boolean Equal = false;
						try {
								///принимаем соединение только когда IP совпадает
								String address = ((InetSocketAddress) UserSocket.getRemoteSocketAddress()).getAddress().getHostAddress();
								
								
								////на данный момент € реализовал вход через одну точку
								/// » сервер и пользователи стучатс€ в один сокет
								Equal = InitServer_IpAdress.equals(address);
								///  нам стучит сервер входа - очередной пользователь добавилс€
								if(Equal)
								{
									final DataInputStream in = new DataInputStream(UserSocket.getInputStream());
									String IP = in.readUTF();
									String Name = in.readUTF();
									String Surname = in.readUTF();
									
								}
								
								
								i = 0;
								Equal = IpAdress[i].equals(address);
								while(!Equal && i < (HowMany-1) )
								{
									i = i+1;
									Equal = IpAdress[i].equals(address);
								}
								///все хорошо Ip адрес найден среди списка - прин€ть соединение
								/// ≈сли нет - игнорируем соединение и переходим к следующему в очереди
								if (Equal) 
								{
									final DataInputStream in = new DataInputStream(UserSocket.getInputStream());
									String SomeMessage = in.readUTF();
									
									
								}
								
								
							
						     }
						     finally
						     {
							       UserSocket.close();
						     }			
					}
				} 
				finally
				{
					AuthorisationSocket.close();
				}	
				///ћожно убрать
				Thread.sleep(100);
			}
		} 
		catch (InterruptedException | IOException ex) 
		{
			// ≈сли нас прервали, то ничего не делаем 
			// и просто выходим (завершаемс€)
		}
		
	}
	public void AddUser()
	{
		String[] IpAdress_old;
		String[] NameUsers_old;
		String[] SurnameUsers_old;
		IpAdress_old = IpAdress;
		NameUsers_old =  NameUsers;
		SurnameUsers_old = SurnameUsers;
	}
	
	
	
	// ћетод прорисовки самого себ€
	
}












